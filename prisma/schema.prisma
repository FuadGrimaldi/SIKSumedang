datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model users {
  id             Int      @id @default(autoincrement())
  kecamatan_id   Int?
  nik            String   @unique @db.VarChar(16)
  username       String   @unique @db.VarChar(50)
  full_name      String   @db.VarChar(255)
  email          String   @unique @db.VarChar(255)
  password       String   @db.VarChar(255)
  role           Role
  status         Status
  last_login_at  DateTime?  
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  profile_kecamatan profile_kecamatan? @relation(fields: [kecamatan_id], references: [id])
  articles         articles[]
  acara acara[]
}

model profile_kecamatan {
  id               Int       @id @default(autoincrement())
  nama_kecamatan   String
  subdomain        String
  alamat           String
  telepon          String
  email            String
  website          String?
  foto_kantor      String    @db.VarChar(255)
  visi             String    @db.LongText
  misi             String    @db.LongText
  sejarah          String    @db.LongText
  deskripsi        String    @db.LongText
  gmaps_embed_url  String    @db.LongText
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt

  users            users[]
  komentar         komentar[]  
  pengaduan_aspirasi pengaduan_aspirasi[]
  infografis       infografis[]
  articles         articles[]
  videos           videos[]
  acara             acara[]
  desa              desa[]
  kategori_article   kategori_article[]
  sub_kategori_article        sub_kategori_article[]
  front_image        front_image[]
  officials        officials[]
}

model front_image {
  id           Int      @id @default(autoincrement())
  kecamatan_id Int  
  title        String   @db.VarChar(255)
  lokasi       String   @db.VarChar(255)
  gambar_path  String   @db.VarChar(255)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
}

model infografis {
  id           Int      @id @default(autoincrement())
  kecamatan_id Int  
  title        String   @db.VarChar(255)
  gambar_path  String   @db.VarChar(255)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
}

model articles {
  id                   Int    @id @default(autoincrement())
  user_id              Int
  kecamatan_id         Int
  desa_id              Int
  kategori_id          Int
  sub_kategori_id      Int
  title                String    @unique @db.VarChar(255)
  slug                 String    @unique
  content              String    @db.LongText
  featured_image       String    @db.VarChar(255)
  waktu_kegiatan       DateTime
  lokasi_kegiatan      String    @db.VarChar(255)
  status               ArticleStatus
  published_at         DateTime
  created_at           DateTime  @default(now())
  updated_at           DateTime  @updatedAt

  komentar           komentar[]
  users              users? @relation(fields: [user_id], references: [id])
  profile_kecamatan  profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
  desa               desa @relation(fields: [desa_id], references: [id])
  kategori_article   kategori_article @relation(fields: [kategori_id], references: [id])
  sub_kategori_article sub_kategori_article @relation(fields: [sub_kategori_id], references: [id])
}

model desa {
  id           Int    @id @default(autoincrement())
  kecamatan_id Int
  nama_desa    String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
  articles     articles[]
}

model kategori_article {
  id           Int    @id @default(autoincrement())
  kecamatan_id Int
  nama         String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  
  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
  articles     articles[]
  sub_kategori sub_kategori_article[]
}

model sub_kategori_article {
  id           Int    @id @default(autoincrement())
  kecamatan_id Int
  kategori_id  Int
  sub_nama     String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  kategori_article kategori_article @relation(fields: [kategori_id], references: [id])
  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
  articles        articles[]
}

model videos {
  id           Int      @id @default(autoincrement())
  kecamatan_id Int
  title        String   @db.VarChar(255)
  embed_url    String   @db.VarChar(255)
  kategori     String   
  deskripsi    String   @db.LongText
  uploaded_at  DateTime
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
}

model acara {
  id             Int     @id @default(autoincrement())
  user_id         Int
  kecamatan_id   Int
  judul          String  @db.VarChar(255)
  slug           String  @unique
  deskripsi      String  @db.LongText
  lokasi         String  @db.VarChar(255)
  waktu          DateTime
  poster         String  @db.VarChar(255)
  penyelenggara  String  @db.VarChar(255)
  status_acara   StatusAcara
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
  users             users  @relation(fields: [user_id], references: [id])
}

model officials {
  id            Int     @id @default(autoincrement())
  kecamatan_id  Int
  name          String
  position      String
  photo         String
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
}

model komentar {
  id            Int     @id @default(autoincrement())
  kecamatan_id  Int
  article_id    Int
  name          String  @db.VarChar(255)
  email         String  @db.VarChar(255)
  no_telp       String
  pesan         String  @db.LongText
  status        Status
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
  articles      articles @relation(fields: [article_id], references: [id])
}

model pengaduan_aspirasi {
  id            Int     @id @default(autoincrement())
  kecamatan_id  Int
  name          String  @db.VarChar(255)
  email         String  @db.VarChar(255)
  no_telp       String
  pesan         String  @db.LongText
  kategori      PengaduanAspirasiKategori
  status        Status
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  profile_kecamatan profile_kecamatan @relation(fields: [kecamatan_id], references: [id])
}

//
// ENUM DEFINITIONS
//

enum PengaduanAspirasiKategori {
  pengaduan
  aspirasi
}

enum Role {
  admin_kecamatan
  masyarakat
  admin_kab
}

enum Status {
  pending
  approved
  rejected
}

enum ArticleStatus {
  published
  draft
}

enum StatusAcara {
  published
  draft
}
